<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Live Video Surveillance</title>
    <style>
      body { display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
      #video-frame { border: 1px solid #333; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Live Video Surveillance</h1>
    <img id="video-frame" width="640" height="480" alt="Connecting to video..." />

<script>
  (function() {
      const wsScheme = window.location.protocol === 'https:' ? 'wss' : 'ws';
      // The string below must match the path in asgi.py *exactly*, including trailing slash:
      const socket = new WebSocket(wsScheme + '://' + window.location.host + '/ws/video_feed/');
      socket.onopen = () => console.log('WS open');
      socket.onmessage = evt => {
          const msg = JSON.parse(evt.data);
          if (msg.type === 'frame') {
              document.getElementById('video-frame').src = 'data:image/jpeg;base64,' + msg.data;
          }
      };
      socket.onclose = () => console.log('WS closed');
      socket.onerror = err => console.error('WS error', err);
  })();
</script>
</body>
</html>